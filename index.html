<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Distribuidora Jazmín</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
*{box-sizing:border-box;}
body{margin:0;font-family:Arial, sans-serif;background:#0f0f0f;color:white;}
header{display:flex;align-items:center;justify-content:center;gap:10px;background:#181818;padding:15px;font-size:20px;font-weight:bold;box-shadow:0 2px 10px rgba(0,0,0,0.5);position:relative;}
header img{width:40px;height:40px;border-radius:50%;}
#contador{position:absolute;right:15px;top:15px;background:#00c853;width:22px;height:22px;border-radius:50%;font-size:12px;display:flex;align-items:center;justify-content:center;}
nav{display:flex;justify-content:center;gap:10px;padding:10px;}
nav button{padding:8px 15px;border:none;border-radius:20px;background:#2a2a2a;color:white;cursor:pointer;}
nav button.activo{background:#00c853;}
input{display:block;margin:10px auto;padding:10px;width:90%;max-width:400px;border-radius:20px;border:none;outline:none;background:#1f1f1f;color:white;}
.productos{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px;padding:12px;padding-bottom:180px;}
.card{background:#1c1c1c;padding:12px;border-radius:15px;text-align:center;box-shadow:0 4px 10px rgba(0,0,0,0.4);}
.card h4{margin:5px 0;font-size:14px;min-height:40px;}
.precio{color:#00e676;font-weight:bold;margin:5px 0;}
.estado{font-size:12px;margin-bottom:6px;}
.sin{color:#ff5252;}
.disp{color:#00e676;}
.controles{display:flex;justify-content:center;align-items:center;gap:10px;}
.controles button{width:30px;height:30px;border:none;border-radius:50%;background:#00c853;color:white;font-size:18px;cursor:pointer;}
.controles button:disabled{background:#555;cursor:not-allowed;}
#carrito{position:fixed;bottom:0;left:0;right:0;background:#1a1a1a;border-top-left-radius:25px;border-top-right-radius:25px;box-shadow:0 -4px 20px rgba(0,0,0,0.7);transform:translateY(65%);transition:0.4s;}
#carrito.abierto{transform:translateY(0);}
.marca{width:50px;height:6px;background:#777;border-radius:10px;margin:10px auto;cursor:pointer;}
.carrito-contenido{max-height:250px;overflow-y:auto;padding:10px;font-size:14px;}
.total{text-align:center;font-weight:bold;margin:10px;}
.whatsapp{display:block;background:#25d366;color:white;text-align:center;padding:12px;margin:10px;border-radius:20px;text-decoration:none;font-weight:bold;border:none;cursor:pointer;}
.confirmar{background:#2962ff;}
.pdfbtn{background:#ff9800;}
.vaciar{text-align:center;color:#ff5252;cursor:pointer;margin-bottom:5px;}
#datosTransferencia{display:none;padding:15px;text-align:center;background:#111;font-size:14px;}
</style>
</head>

<body>

<header>
<img src="https://i.postimg.cc/hPRrFtWD/Jazmin-png.jpg">
Distribuidora Jazmín
<div id="contador">0</div>
</header>

<nav>
<button id="btnBebidas" class="activo">Bebidas</button>
<button id="btnAlmacen">Almacén</button>
</nav>

<input type="text" id="buscador" placeholder="Buscar producto...">
<div class="productos" id="productos"></div>

<div id="carrito">
<div class="marca" onclick="toggleCarrito()"></div>
<div class="carrito-contenido" id="listaCarrito"></div>
<div class="vaciar" onclick="vaciarCarrito()">Vaciar carrito</div>
<div class="total" id="total"></div>

<a id="enviar" class="whatsapp" target="_blank">
Enviar pedido por WhatsApp
</a>

<button onclick="confirmarPedido()" class="whatsapp confirmar">
Confirmar pedido
</button>

<div id="datosTransferencia">
<p><strong>N° Pedido:</strong> <span id="numeroPedido"></span></p>
<p><strong>Total a transferir:</strong> <span id="montoFinal"></span></p>
<p><strong>Alias:</strong> jazminonlineshop</p>
<p><strong>CVU:</strong> 0000003100054608688074</p>
<button onclick="descargarPDF()" class="whatsapp pdfbtn">
Descargar comprobante PDF
</button>
</div>

</div>

<script>
const SHEET_ID="1ulQgsiH4VPgtws9Abo8wGo4xcwWHVi-hEkeKUqUbRWE";
const BEBIDAS="Bebidas";
const ALMACEN="Almacen";

let categoriaActual=BEBIDAS;
let productos=[];
let carrito={};
let abierto=false;
let numeroPedidoGenerado="";

async function cargarDatos(){
const url=`https://opensheet.elk.sh/${SHEET_ID}/${categoriaActual}`;
const res=await fetch(url);
productos=await res.json();
mostrarProductos();
}

function mostrarProductos(){
const cont=document.getElementById("productos");
cont.innerHTML="";
const filtro=document.getElementById("buscador").value.toLowerCase();

productos
.filter(p=>p.codigo && p.producto && p.precio && !isNaN(Number(p.precio)) && p.producto.toLowerCase().includes(filtro))
.forEach(p=>{
const precioNumero=Number(p.precio);
const div=document.createElement("div");
div.className="card";
div.innerHTML=`
<h4>${p.producto}</h4>
<div class="precio">$${precioNumero.toLocaleString()}</div>
<div class="estado ${p.estado==="SIN STOCK"?"sin":"disp"}">${p.estado||"DISPONIBLE"}</div>
<div class="controles">
<button onclick="cambiar('${p.codigo}',-1)">-</button>
<span>${carrito[p.codigo]?.cantidad||0}</span>
<button ${p.estado==="SIN STOCK"?"disabled":""} onclick="cambiar('${p.codigo}',1)">+</button>
</div>
`;
cont.appendChild(div);
});
}

function cambiar(codigo,valor){
const prod=productos.find(p=>p.codigo===codigo);
if(!prod) return;
if(!carrito[codigo]){carrito[codigo]={...prod,cantidad:0};}
carrito[codigo].cantidad+=valor;
if(carrito[codigo].cantidad<=0){delete carrito[codigo];}
actualizarCarrito();
mostrarProductos();
abrirCarrito();
}

function actualizarCarrito(){
const lista=document.getElementById("listaCarrito");
lista.innerHTML="";
let total=0;
let cantidadTotal=0;
let mensaje="Hola, quiero pedir:%0A";

Object.values(carrito).forEach(p=>{
const subtotal=p.cantidad*Number(p.precio);
total+=subtotal;
cantidadTotal+=p.cantidad;
lista.innerHTML+=`<div>${p.producto} x${p.cantidad} - $${subtotal.toLocaleString()}</div>`;
mensaje+=`${p.producto} x${p.cantidad} - $${subtotal}%0A`;
});

document.getElementById("total").innerText="Total: $"+total.toLocaleString();
document.getElementById("contador").innerText=cantidadTotal;
mensaje+=`%0ATotal: $${total}`;
document.getElementById("enviar").href=`https://wa.me/5493425695340?text=${mensaje}`;
}

function confirmarPedido(){
if(Object.keys(carrito).length===0){alert("Carrito vacío");return;}
let total=0;
Object.values(carrito).forEach(p=>{total+=p.cantidad*Number(p.precio);});
numeroPedidoGenerado="DJ-"+Date.now();
document.getElementById("numeroPedido").innerText=numeroPedidoGenerado;
document.getElementById("montoFinal").innerText="$"+total.toLocaleString();
document.getElementById("datosTransferencia").style.display="block";
}

function descargarPDF(){
const { jsPDF } = window.jspdf;
const doc = new jsPDF();
let y=20;
doc.addImage("https://i.postimg.cc/hPRrFtWD/Jazmin-png.jpg","JPEG",80,5,50,20);
doc.text("Distribuidora Jazmín",20,y); y+=10;
doc.text("Pedido: "+numeroPedidoGenerado,20,y); y+=10;
Object.values(carrito).forEach(p=>{
doc.text(`${p.producto} x${p.cantidad}`,20,y);
y+=8;
});
doc.text("Total: "+document.getElementById("montoFinal").innerText,20,y+10);
doc.text("Alias: jazminonlineshop",20,y+20);
doc.text("CVU: 0000003100054608688074",20,y+30);
doc.save("pedido-"+numeroPedidoGenerado+".pdf");
}

function abrirCarrito(){abierto=true;document.getElementById("carrito").classList.add("abierto");}
function toggleCarrito(){abierto=!abierto;document.getElementById("carrito").classList.toggle("abierto");}
function vaciarCarrito(){carrito={};actualizarCarrito();mostrarProductos();document.getElementById("datosTransferencia").style.display="none";}
document.getElementById("buscador").addEventListener("input",mostrarProductos);
btnBebidas.onclick=()=>{categoriaActual=BEBIDAS;btnBebidas.classList.add("activo");btnAlmacen.classList.remove("activo");cargarDatos();};
btnAlmacen.onclick=()=>{categoriaActual=ALMACEN;btnAlmacen.classList.add("activo");btnBebidas.classList.remove("activo");cargarDatos();};
cargarDatos();
</script>

</body>
</html>
