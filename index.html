<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Distribuidora Jazmín</title>

<style>
*{box-sizing:border-box;}
body{
margin:0;
font-family:Arial, sans-serif;
background:#0f0f0f;
color:white;
}

header{
display:flex;
align-items:center;
justify-content:center;
gap:10px;
background:#181818;
padding:15px;
font-size:20px;
font-weight:bold;
box-shadow:0 2px 10px rgba(0,0,0,0.5);
}

header img{
width:40px;
height:40px;
border-radius:50%;
}

nav{
display:flex;
justify-content:center;
gap:10px;
padding:10px;
}

nav button{
padding:8px 15px;
border:none;
border-radius:20px;
background:#2a2a2a;
color:white;
cursor:pointer;
transition:0.3s;
}

nav button.activo{
background:#00c853;
}

input{
display:block;
margin:10px auto;
padding:10px;
width:90%;
max-width:400px;
border-radius:20px;
border:none;
outline:none;
background:#1f1f1f;
color:white;
}

.productos{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
gap:12px;
padding:12px;
padding-bottom:120px;
}

.card{
background:#1c1c1c;
padding:12px;
border-radius:15px;
text-align:center;
box-shadow:0 4px 10px rgba(0,0,0,0.4);
transition:0.2s;
}

.card:hover{
transform:scale(1.03);
}

.card h4{
margin:5px 0;
font-size:14px;
min-height:40px;
}

.precio{
color:#00e676;
font-weight:bold;
margin:5px 0;
}

.estado{
font-size:12px;
margin-bottom:6px;
}

.sin{color:#ff5252;}
.disp{color:#00e676;}

.controles{
display:flex;
justify-content:center;
align-items:center;
gap:10px;
}

.controles button{
width:30px;
height:30px;
border:none;
border-radius:50%;
background:#00c853;
color:white;
font-size:18px;
cursor:pointer;
}

#carrito{
position:fixed;
bottom:0;
left:0;
right:0;
background:#1a1a1a;
border-top-left-radius:25px;
border-top-right-radius:25px;
box-shadow:0 -4px 20px rgba(0,0,0,0.7);
transform:translateY(65%);
transition:transform 0.4s ease;
}

#carrito.abierto{
transform:translateY(0);
}

.marca{
width:50px;
height:6px;
background:#777;
border-radius:10px;
margin:10px auto;
cursor:pointer;
}

.carrito-contenido{
max-height:250px;
overflow-y:auto;
padding:10px;
font-size:14px;
}

.total{
text-align:center;
font-weight:bold;
margin:10px;
font-size:16px;
}

.whatsapp{
display:block;
background:#25d366;
color:white;
text-align:center;
padding:12px;
margin:10px;
border-radius:20px;
text-decoration:none;
font-weight:bold;
}
</style>
</head>

<body>

<header>
<img src="https://i.postimg.cc/hPRrFtWD/Jazmin-png.jpg">
Distribuidora Jazmín
</header>

<nav>
<button id="btnBebidas" class="activo">Bebidas</button>
<button id="btnAlmacen">Almacén</button>
</nav>

<input type="text" id="buscador" placeholder="Buscar producto...">

<div class="productos" id="productos"></div>

<div id="carrito">
<div class="marca" onclick="toggleCarrito()"></div>
<div class="carrito-contenido" id="listaCarrito"></div>
<div class="total" id="total"></div>
<a id="enviar" class="whatsapp" target="_blank">
Enviar pedido por WhatsApp
</a>
</div>

<script>
const SHEET_ID="1ulQgsiH4VPgtws9Abo8wGo4xcwWHVi-hEkeKUqUbRWE";
const BEBIDAS="Bebidas";
const ALMACEN="Almacen";
let categoriaActual=BEBIDAS;
let productos=[];
let carrito=JSON.parse(localStorage.getItem("carrito"))||{};
let abierto=false;

async function cargarDatos(){
const url=`https://opensheet.elk.sh/${SHEET_ID}/${categoriaActual}`;
const res=await fetch(url);
productos=await res.json();
mostrarProductos();
}

function mostrarProductos(){
const cont=document.getElementById("productos");
cont.innerHTML="";
const filtro=document.getElementById("buscador").value.toLowerCase();

productos
.filter(p=>p.producto && p.producto.toLowerCase().includes(filtro))
.forEach(p=>{
const div=document.createElement("div");
div.className="card";
div.innerHTML=`
<h4>${p.producto}</h4>
<div class="precio">$${Number(p.precio).toLocaleString()}</div>
<div class="estado ${p.estado==="SIN STOCK"?"sin":"disp"}">${p.estado}</div>
<div class="controles">
<button onclick="cambiar('${p.codigo}',-1)">-</button>
<span>${carrito[p.codigo]?.cantidad||0}</span>
<button onclick="cambiar('${p.codigo}',1)">+</button>
</div>
`;
cont.appendChild(div);
});
}

function cambiar(codigo,valor){
const prod=productos.find(p=>p.codigo===codigo);
if(!prod) return;

if(!carrito[codigo]){
carrito[codigo]={...prod,cantidad:0};
}

carrito[codigo].cantidad+=valor;
if(carrito[codigo].cantidad<=0){
delete carrito[codigo];
}

localStorage.setItem("carrito",JSON.stringify(carrito));
mostrarProductos();
actualizarCarrito();
}

function actualizarCarrito(){
const lista=document.getElementById("listaCarrito");
lista.innerHTML="";
let total=0;
let mensaje="Hola, quiero pedir:%0A";

Object.values(carrito).forEach(p=>{
const subtotal=p.cantidad*Number(p.precio);
total+=subtotal;

lista.innerHTML+=`
<div>${p.producto} x${p.cantidad} - $${subtotal.toLocaleString()}</div>
`;

mensaje+=`${p.producto} x${p.cantidad} - $${subtotal}%0A`;
});

document.getElementById("total").innerText="Total: $"+total.toLocaleString();
mensaje+=`%0ATotal: $${total}`;

document.getElementById("enviar").href=
`https://wa.me/5493425695340?text=${mensaje}`;
}

function toggleCarrito(){
abierto=!abierto;
document.getElementById("carrito").classList.toggle("abierto");
}

document.getElementById("buscador").addEventListener("input",mostrarProductos);

document.getElementById("btnBebidas").onclick=()=>{
categoriaActual=BEBIDAS;
btnBebidas.classList.add("activo");
btnAlmacen.classList.remove("activo");
cargarDatos();
};

document.getElementById("btnAlmacen").onclick=()=>{
categoriaActual=ALMACEN;
btnAlmacen.classList.add("activo");
btnBebidas.classList.remove("activo");
cargarDatos();
};

cargarDatos();
actualizarCarrito();
</script>

</body>
</html>
